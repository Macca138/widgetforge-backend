<!DOCTYPE html>
<html>
<head>
  <title>WidgetForge: Ticker Builder</title>
  <style>
    body { font-family: Inter, sans-serif; padding: 2em; max-width: 700px; margin: auto; background: #f8f8f8; }
    label { display: block; margin-top: 1em; font-weight: 600; }
    input, select { width: 100%; padding: 8px; font-size: 14px; }
    .checkbox-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 0.5rem; }
    .preview-box { border: 1px solid #ccc; padding: 10px; margin-top: 2em; background: white; }
    .iframe-box { background: #eef; padding: 10px; margin-top: 1em; font-family: monospace; }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Inter&family=Roboto&family=Open+Sans&family=Lato&family=Montserrat&family=Oswald&family=Source+Sans+Pro&display=swap" rel="stylesheet">
</head>
<body>
  <h1>üéõÔ∏è Build Your Live Ticker Widget</h1>

  <form id="configForm">
  <fieldset>
    <legend>Select Assets</legend>
    <div class="checkbox-grid">
      {% for asset in all_assets %}
        <label>
          <input type="checkbox" name="assets" value="{{ asset }}" {% if asset in selected_assets %}checked{% endif %}>
          {{ asset }}
        </label>
      {% endfor %}
    </div>
  </fieldset>

  <label>
    Font:
    <input type="text" name="font" value="{{ font }}">
  </label><br>

  <label>
    Font Size:
    <input type="number" name="fontSize" value="{{ font_size }}">
  </label><br>

  <label>
    Font Color:
    <input type="color" name="fontColor" value="{{ font_color }}">
  </label><br>

  <label>
    Background Color:
    <input type="color" name="bgColor" value="{{ bg_color }}">
  </label><br>

  <label>
    Scroll Speed:
    <input type="number" name="scrollSpeed" value="{{ scroll_speed }}">
  </label><br>

  <label>
    Static Text:
    <input type="text" name="staticText" value="{{ static_text }}">
  </label><br>

  <label>
    Show Logo:
    <input type="checkbox" name="show_logo" {% if show_logo == "true" %}checked{% endif %}>
  </label><br>
  <label>
  Widget Width (px or %):
  <input type="text" name="widgetWidth" value="100%">
  </label><br>

  <label>
  Widget Height (px):
  <input type="text" name="widgetHeight" value="100">
  </label><br>

  <button type="submit">Generate Widget</button>
</form>

  <div class="preview-box" id="previewBox" style="display:none;">
    <h3>üîó Your Embed Code</h3>
    <div class="iframe-box">
      <code id="iframeCode"></code>
    </div>
    <h3>üëÄ Live Preview</h3>
    <iframe id="previewFrame" width="100%" height="100" style="border:none;"></iframe>
  </div>

  <script>
  document.getElementById('configForm').onsubmit = function(e) {
    e.preventDefault();

    const checkedSymbols = Array.from(document.querySelectorAll('input[name="assets"]:checked'))
      .map(cb => cb.value)
      .join(',');

    const font = document.querySelector('[name="font"]').value;
    const fontSize = document.querySelector('[name="fontSize"]').value;
    const fontColor = document.querySelector('[name="fontColor"]').value;
    const bgColor = document.querySelector('[name="bgColor"]').value;
    const scrollSpeed = document.querySelector('[name="scrollSpeed"]').value;
    const staticText = document.querySelector('[name="staticText"]').value;
    const showLogo = document.querySelector('[name="show_logo"]').checked ? "true" : "false";
    const widgetWidth = document.querySelector('[name="widgetWidth"]').value;
    const widgetHeight = document.querySelector('[name="widgetHeight"]').value;


    const params = new URLSearchParams({
      symbols: checkedSymbols,
      font,
      fontSize,
      fontColor,
      bgColor,
      scrollSpeed,
      staticText,
      show_logo: showLogo
    });

    const src = `http://62.171.135.138:8000/widgets/ticker?${params.toString()}`;
    const iframeHTML = `<iframe src="${src}" width="${widgetWidth}" height="${widgetHeight}" frameborder="0"></iframe>`;

    document.getElementById('iframeCode').textContent = iframeHTML;
    document.getElementById('previewFrame').src = src;
    document.getElementById('previewBox').style.display = 'block';
    document.getElementById('previewFrame').width = widgetWidth;
    document.getElementById('previewFrame').height = widgetHeight;

  };
</script>

</body>
</html>
