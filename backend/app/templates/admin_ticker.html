<!DOCTYPE html>
<html>
<head>
  <title>WidgetForge: Ticker Builder</title>
  <style>
    body { font-family: Inter, sans-serif; padding: 2em; max-width: 700px; margin: auto; background: #f8f8f8; }
    label { display: block; margin-top: 1em; font-weight: 600; }
    input, select { width: 100%; padding: 8px; font-size: 14px; }
    .preview-box { border: 1px solid #ccc; padding: 10px; margin-top: 2em; background: white; }
    .iframe-box { background: #eef; padding: 10px; margin-top: 1em; font-family: monospace; }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Inter&family=Roboto&family=Open+Sans&family=Lato&family=Montserrat&family=Oswald&family=Source+Sans+Pro&display=swap" rel="stylesheet">
</head>
<body>
  <h1>üéõÔ∏è Build Your Live Ticker Widget</h1>

  <form method="GET" action="/widgets/ticker">
  <fieldset>
    <legend>Select Assets</legend>
    {% for asset in all_assets %}
      <label>
        <input type="checkbox" name="symbols" value="{{ asset }}"
          {% if asset in selected_assets %}checked{% endif %}>
        {{ asset }}
      </label><br>
    {% endfor %}
  </fieldset>

  <label>
    Font:
    <input type="text" name="font" value="{{ font }}">
  </label><br>

  <label>
    Font Size:
    <input type="number" name="fontSize" value="{{ font_size }}">
  </label><br>

  <label>
    Font Color:
    <input type="color" name="fontColor" value="{{ font_color }}">
  </label><br>

  <label>
    Background Color:
    <input type="color" name="bgColor" value="{{ bg_color }}">
  </label><br>

  <label>
    Scroll Speed:
    <input type="number" name="scrollSpeed" value="{{ scroll_speed }}">
  </label><br>

  <label>
    Static Text:
    <input type="text" name="staticText" value="{{ static_text }}">
  </label><br>

  <label>
    Show Logo:
    <input type="checkbox" name="show_logo" {% if show_logo == "true" %}checked{% endif %}>
  </label><br>

  <button type="submit">Generate Widget</button>
</form>

  <div class="preview-box" id="previewBox" style="display:none;">
    <h3>üîó Your Embed Code</h3>
    <div class="iframe-box">
      <code id="iframeCode"></code>
    </div>
    <h3>üëÄ Live Preview</h3>
    <iframe id="previewFrame" width="100%" height="100" style="border:none;"></iframe>
  </div>

  <script>
    document.getElementById('configForm').onsubmit = function(e) {
      e.preventDefault();
      const symbols = Array.from(document.getElementById('symbols').selectedOptions).map(opt => opt.value).join(',');
      const font = document.getElementById('font').value;
      const fontSize = document.getElementById('fontSize').value;
      const fontColor = document.getElementById('fontColor').value;
      const bgColor = document.getElementById('bgColor').value;
      const scrollSpeed = document.getElementById('scrollSpeed').value;
      const staticText = document.getElementById('staticText').value;
      const widgetWidth = document.getElementById('widgetWidth').value;
      const widgetHeight = document.getElementById('widgetHeight').value;
      const showLogo = document.getElementById('showLogo').value;

      const params = new URLSearchParams({
        symbols, font, fontSize, fontColor, bgColor, scrollSpeed, staticText, showLogo
      });

      const src = `http://62.171.135.138:8000/widgets/ticker?${params.toString()}`;
      const iframeHTML = `<iframe src="${src}" width="${widgetWidth}" height="${widgetHeight}" frameborder="0"></iframe>`;

      document.getElementById('iframeCode').textContent = iframeHTML;
      document.getElementById('previewFrame').src = src;
      document.getElementById('previewFrame').width = widgetWidth;
      document.getElementById('previewFrame').height = widgetHeight;
      document.getElementById('previewBox').style.display = 'block';
    };
  </script>
  
  <script>
  window.onload = function () {
    fetch("/assets")
      .then(response => response.text())
      .then(html => {
        document.getElementById("symbols").innerHTML = html;
      });
  };
</script>

</body>
</html>
